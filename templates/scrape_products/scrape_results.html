{% extends '_base.html' %}

{% block title %}Scraping Results{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Scraping Results</h1>
        <div>
            <button id="copyButton" class="btn btn-outline-primary">
                <i class="far fa-copy"></i> Copy to Clipboard
            </button>
            <a href="{{ request.META.HTTP_REFERER }}" class="btn btn-secondary ml-2">
                <i class="fas fa-arrow-left"></i> Back to Scraper
            </a>
        </div>
    </div>

    {% if result %}
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Results</h5>
                <span id="copyStatus" class="text-muted small"></span>
            </div>
            <div class="card-body p-0">
                {% if 'data' in result or 'error' in result %}
                    <pre id="jsonResult" class="bg-light p-3 mb-0" style="max-height: 70vh; overflow-y: auto; margin: 0;">
{{ result|safe }}
                    </pre>
                {% else %}
                    <div class="alert alert-info m-3">
                        {{ result|safe }}
                    </div>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="alert alert-warning">
            No results to display.
        </div>
    {% endif %}
</div>

<style>
    pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        margin-bottom: 0 !important;
    }
    .token.string {
        color: #28a745;
    }
    .token.number {
        color: #007bff;
    }
    .token.boolean {
        color: #dc3545;
    }
    .token.null {
        color: #6c757d;
    }
    .token.key {
        color: #6f42c1;
    }
    #copyStatus {
        transition: opacity 0.3s;
    }
    .fade-out {
        opacity: 0;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const copyButton = document.getElementById('copyButton');
    const copyStatus = document.getElementById('copyStatus');
    const jsonResult = document.getElementById('jsonResult');

    if (copyButton && jsonResult) {
        copyButton.addEventListener('click', function() {
            // Select the text
            const range = document.createRange();
            range.selectNode(jsonResult);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            try {
                // Execute the copy command
                const successful = document.execCommand('copy');
                const message = successful ? 'Copied!' : 'Unable to copy';

                // Update status
                copyStatus.textContent = message;
                copyStatus.classList.remove('fade-out');

                // Clear selection
                window.getSelection().removeAllRanges();

                // Reset status after 2 seconds
                setTimeout(() => {
                    copyStatus.classList.add('fade-out');
                    setTimeout(() => {
                        copyStatus.textContent = '';
                    }, 300);
                }, 2000);

            } catch (err) {
                console.error('Failed to copy text: ', err);
                copyStatus.textContent = 'Failed to copy';
                copyStatus.classList.remove('fade-out');

                setTimeout(() => {
                    copyStatus.classList.add('fade-out');
                    setTimeout(() => {
                        copyStatus.textContent = '';
                    }, 300);
                }, 2000);
            }
        });
    }
});
</script>

{% endblock content %}